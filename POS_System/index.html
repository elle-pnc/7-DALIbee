<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grocery Store POS System</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, #0f0f23, #1a1a2e);
            color: #e8e8e8;
            overflow-x: hidden;
            user-select: none;
            transition: all 0.3s ease;
        }
        
        /* Particle Background Effect */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            width: 1px;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 8s infinite linear;
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Enhanced Transitions */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        .slide-up {
            animation: slideUp 0.6s ease-out;
        }
        
        .bounce-in {
            animation: bounceIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(76, 175, 80, 0.3);
            border-radius: 50%;
            border-top-color: #4CAF50;
            animation: spin 1s ease-in-out infinite;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .loading-content {
            background: linear-gradient(145deg, #1e1e42, #2a2a5c);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            color: white;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(76, 175, 80, 0.3);
            border-radius: 50%;
            border-top-color: #4CAF50;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 0 0 30px rgba(76, 175, 80, 0.6);
            }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Minimalistic Button Styles */
        .pixel-btn {
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #e8e8e8;
            padding: 12px 24px;
            font-family: 'Orbitron', monospace;
            font-weight: 500;
            cursor: pointer;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            overflow: hidden;
        }
        
        .pixel-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .pixel-btn:hover::before {
            left: 100%;
        }
        
        .pixel-btn:hover {
            transform: translateY(-1px);
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .pixel-btn:active {
            transform: translateY(2px);
            box-shadow: 
                inset 0 0 0 2px rgba(255,255,255,0.2),
                0 2px 0 #2e7d32,
                0 4px 8px rgba(0,0,0,0.2);
        }
        
        .pixel-btn.scan {
            background: linear-gradient(145deg, #FF6B35, #e55a2b);
            box-shadow: 
                inset 0 0 0 2px rgba(255,255,255,0.2),
                0 4px 0 #cc4822,
                0 8px 15px rgba(0,0,0,0.3);
        }
        
        .pixel-btn.scan:hover {
            box-shadow: 
                inset 0 0 0 2px rgba(255,255,255,0.4),
                0 6px 0 #cc4822,
                0 12px 20px rgba(0,0,0,0.4);
        }
        
        .pixel-btn.scan:active {
            box-shadow: 
                inset 0 0 0 2px rgba(255,255,255,0.2),
                0 2px 0 #cc4822,
                0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* Sleep Mode */
        .sleep-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            cursor: pointer;
        }
        
        .sleep-text {
            color: #333;
            font-size: 24px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }
        
        /* Minimalistic Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header h1 {
            font-size: 2.2em;
            margin-bottom: 8px;
            color: #ffffff;
            font-weight: 300;
            letter-spacing: 2px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.8;
        }
        
        .cart-indicator {
            background: linear-gradient(145deg, #2a2a5c, #1e1e42);
            padding: 15px 20px;
            border-radius: 10px;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                inset 0 0 0 2px rgba(255,255,255,0.1),
                0 5px 15px rgba(0,0,0,0.3);
            animation: slideUp 0.5s ease-out;
        }
        
        .cart-indicator span {
            color: #4CAF50;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        /* Login Page Styles */
        .login-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .login-container {
            background: linear-gradient(145deg, #1e1e42, #2a2a5c);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 
                inset 0 0 0 3px rgba(255,255,255,0.1),
                0 20px 60px rgba(0,0,0,0.8);
            text-align: center;
            min-width: 400px;
        }
        
        .login-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #4CAF50;
            text-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
        }
        
        .login-header p {
            font-size: 1.2em;
            opacity: 0.8;
            margin-bottom: 30px;
        }
        
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(145deg, #333366, #2a2a5c);
            color: white;
            font-family: 'Orbitron', monospace;
            font-size: 1em;
            box-shadow: 
                inset 0 0 0 2px rgba(255,255,255,0.1),
                inset 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .input-group input:focus {
            outline: none;
            box-shadow: 
                inset 0 0 0 2px rgba(76, 175, 80, 0.5),
                inset 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .error-message {
            color: #f44336;
            margin-top: 15px;
            font-weight: bold;
        }
        
        /* Lockout Page Styles */
        .lockout-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2e1a1a, #3e1616);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .lockout-container {
            background: linear-gradient(145deg, #421e1e, #5c2a2a);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 
                inset 0 0 0 3px rgba(255,255,255,0.1),
                0 20px 60px rgba(0,0,0,0.8);
            text-align: center;
            min-width: 400px;
        }
        
        .lockout-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #f44336;
            text-shadow: 0 0 20px rgba(244, 67, 54, 0.5);
        }
        
        .lockout-message p {
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        /* Reset Login Page Styles */
        .reset-login-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2e1a1a, #3e1616);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .reset-login-container {
            background: linear-gradient(145deg, #421e1e, #5c2a2a);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 
                inset 0 0 0 3px rgba(255,255,255,0.1),
                0 20px 60px rgba(0,0,0,0.8);
            text-align: center;
            min-width: 400px;
        }
        
        .reset-login-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #f44336;
            text-shadow: 0 0 20px rgba(244, 67, 54, 0.5);
        }
        
        .reset-login-header p {
            font-size: 1.2em;
            opacity: 0.8;
            margin-bottom: 30px;
        }
        
        /* PIN Modal Styles */
        .pin-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        /* RFID Setup Modal */
        .rfid-setup-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .rfid-setup-container {
            background: linear-gradient(145deg, #1e1e42, #2a2a5c);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 
                inset 0 0 0 3px rgba(255,255,255,0.1),
                0 20px 60px rgba(0,0,0,0.8);
            min-width: 400px;
        }
        
        .rfid-setup-header h3 {
            color: #4CAF50;
            margin-bottom: 10px;
        }
        
        .rfid-input-container {
            margin: 20px 0;
        }
        
        .rfid-input-container input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            text-align: center;
            border: none;
            border-radius: 10px;
            background: linear-gradient(145deg, #333366, #2a2a5c);
            color: white;
            font-family: 'Orbitron', monospace;
            box-shadow: 
                inset 0 0 0 2px rgba(255,255,255,0.1),
                inset 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .rfid-input-container input:focus {
            outline: none;
            box-shadow: 
                inset 0 0 0 2px rgba(76, 175, 80, 0.5),
                inset 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .pin-container {
            background: linear-gradient(145deg, #1e1e42, #2a2a5c);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 
                inset 0 0 0 3px rgba(255,255,255,0.1),
                0 20px 60px rgba(0,0,0,0.8);
            min-width: 350px;
        }
        
        .pin-header h3 {
            color: #4CAF50;
            margin-bottom: 10px;
        }
        
        .pin-input-container {
            margin: 20px 0;
        }
        
        .pin-input-container input {
            width: 100%;
            padding: 15px;
            font-size: 1.5em;
            text-align: center;
            border: none;
            border-radius: 10px;
            background: linear-gradient(145deg, #333366, #2a2a5c);
            color: white;
            font-family: 'Orbitron', monospace;
            letter-spacing: 0.2em;
            box-shadow: 
                inset 0 0 0 2px rgba(255,255,255,0.1),
                inset 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .pin-display {
            font-size: 2em;
            color: #4CAF50;
            margin-top: 10px;
            letter-spacing: 0.3em;
        }
        
        .pin-attempts {
            margin: 15px 0;
            color: #FF6B35;
            font-weight: bold;
        }
        
        .pin-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .pin-buttons .pixel-btn {
            flex: 1;
        }
        
        .pin-error {
            color: #f44336;
            margin-top: 15px;
            font-weight: bold;
        }
        
        /* Cashier Info */
        .cashier-info {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 15px;
            font-size: 1.1em;
        }
        
        .cashier-info span {
            color: #4CAF50;
            font-weight: bold;
        }
        
        /* Floating Cart Styles */
        .floating-cart {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .cart-toggle {
            background: linear-gradient(145deg, #4CAF50, #45a049);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 
                inset 0 0 0 2px rgba(255,255,255,0.2),
                0 4px 0 #2e7d32,
                0 8px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .cart-toggle:hover {
            transform: scale(1.1);
            box-shadow: 
                inset 0 0 0 2px rgba(255,255,255,0.4),
                0 6px 0 #2e7d32,
                0 12px 20px rgba(0,0,0,0.4);
        }
        
        .cart-icon {
            font-size: 1.5em;
        }
        
        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #FF6B35;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .cart-content {
            position: absolute;
            top: 70px;
            right: 0;
            background: linear-gradient(145deg, #1e1e42, #2a2a5c);
            border-radius: 15px;
            padding: 20px;
            min-width: 300px;
            max-width: 400px;
            box-shadow: 
                inset 0 0 0 3px rgba(255,255,255,0.1),
                0 10px 30px rgba(0,0,0,0.5);
            animation: slideInDown 0.3s ease-out;
        }
        
        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }
        
        .cart-header h4 {
            color: #4CAF50;
            margin: 0;
        }
        
        .close-cart {
            background: none;
            border: none;
            color: #f44336;
            font-size: 1.5em;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-cart:hover {
            background: rgba(244, 67, 54, 0.2);
        }
        
        .cart-items {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .cart-item:last-child {
            border-bottom: none;
        }
        
        .cart-item-name {
            flex: 1;
            font-size: 0.9em;
        }
        
        .cart-item-quantity {
            color: #4CAF50;
            font-weight: bold;
            margin: 0 10px;
        }
        
        .cart-item-price {
            color: #FF6B35;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .cart-total {
            font-size: 1.2em;
            font-weight: bold;
            color: #4CAF50;
            text-align: center;
            margin-bottom: 10px;
        }
        
        /* Floating Account Styles */
        .floating-account {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }
        
        .account-toggle {
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .account-toggle:hover {
            transform: scale(1.05);
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .account-icon {
            font-size: 1.3em;
        }
        
        .account-content {
            position: absolute;
            top: 60px;
            left: 0;
            background: linear-gradient(145deg, #1e1e42, #2a2a5c);
            border-radius: 12px;
            padding: 20px;
            min-width: 250px;
            box-shadow: 
                inset 0 0 0 3px rgba(255,255,255,0.1),
                0 10px 30px rgba(0,0,0,0.5);
            animation: slideInDown 0.3s ease-out;
            display: none;
        }
        
        .account-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }
        
        .account-header h4 {
            color: #ffffff;
            margin: 0;
            font-weight: 300;
        }
        
        .close-account {
            background: none;
            border: none;
            color: #f44336;
            font-size: 1.5em;
            cursor: pointer;
            padding: 0;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-account:hover {
            background: rgba(244, 67, 54, 0.2);
        }
        
        .cashier-display {
            margin-bottom: 15px;
            text-align: center;
        }
        
        .cashier-label {
            font-size: 0.9em;
            opacity: 0.7;
            display: block;
            margin-bottom: 5px;
        }
        
        .cashier-name {
            font-size: 1.1em;
            font-weight: 300;
            color: #ffffff;
        }
        
        /* History Page Styles */
        .history-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0f23, #1a1a2e);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .history-header h2 {
            color: #ffffff;
            font-weight: 300;
            margin: 0;
        }
        
        .history-filters {
            background: rgba(255, 255, 255, 0.02);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-group label {
            color: #ffffff;
            font-size: 0.9em;
            font-weight: 300;
        }
        
        .filter-group input {
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            font-family: 'Orbitron', monospace;
            font-size: 0.9em;
        }
        
        .filter-group input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .history-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .history-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.15);
        }
        
        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .receipt-id {
            font-size: 1.1em;
            font-weight: 300;
            color: #ffffff;
        }
        
        .receipt-date {
            font-size: 0.9em;
            opacity: 0.7;
        }
        
        .history-item-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .detail-item {
            text-align: center;
        }
        
        .detail-label {
            font-size: 0.8em;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-size: 1em;
            font-weight: 300;
            color: #ffffff;
        }
        
        .history-item-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .view-receipt-btn {
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #e8e8e8;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .view-receipt-btn:hover {
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        /* Minimalistic Chart Section */
        .chart-section {
            background: rgba(255, 255, 255, 0.02);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .chart-title {
            font-size: 1.1em;
            margin-bottom: 20px;
            color: #ffffff;
            text-align: center;
            font-weight: 300;
            letter-spacing: 1px;
        }
        
        .chart-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.15);
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: 300;
            color: #ffffff;
            transition: all 0.3s ease;
        }
        
        .stat-value:hover {
            color: #e8e8e8;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        /* Products Grid */
        .products-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.3em;
            margin-bottom: 25px;
            color: #ffffff;
            text-align: center;
            font-weight: 300;
            letter-spacing: 1px;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .product-card {
            background: linear-gradient(145deg, rgba(0,0,0,0.3), rgba(0,0,0,0.6));
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(76, 175, 80, 0.1) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        
        .product-card:hover::before {
            transform: translateX(100%);
        }
        
        .product-card:hover {
            transform: translateY(-4px);
            background: linear-gradient(145deg, rgba(0,0,0,0.4), rgba(0,0,0,0.7));
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .product-card.rfid-ready {
            border-color: rgba(76, 175, 80, 0.5);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.2);
        }
        
        .product-card.rfid-ready:hover {
            border-color: rgba(76, 175, 80, 0.8);
            box-shadow: 0 0 30px rgba(76, 175, 80, 0.4);
        }
        
        .product-image {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .product-image:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .product-name {
            font-size: 1.1em;
            font-weight: 300;
            margin-bottom: 8px;
            color: #ffffff;
        }
        
        .product-price {
            font-size: 1.2em;
            color: #e8e8e8;
            font-weight: 400;
            margin-bottom: 12px;
        }
        
        .product-stock {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 15px;
        }
        
        /* Order Page */
        .order-page {
            display: none;
            animation: slideInRight 0.5s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100px);
            }
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: linear-gradient(145deg, #2a2a5c, #1e1e42);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 
                inset 0 0 0 3px rgba(255,255,255,0.1),
                0 10px 30px rgba(0,0,0,0.5);
        }
        
        .order-items {
            background: linear-gradient(145deg, #1e1e42, #2a2a5c);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 
                inset 0 0 0 3px rgba(255,255,255,0.1),
                0 10px 30px rgba(0,0,0,0.5);
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: linear-gradient(145deg, #333366, #2a2a5c);
            border-radius: 10px;
            box-shadow: 
                inset 0 0 0 2px rgba(255,255,255,0.1),
                0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            animation: slideInUp 0.4s ease-out;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .order-item:hover {
            transform: translateY(-2px);
            box-shadow: 
                inset 0 0 0 2px rgba(255,255,255,0.2),
                0 8px 20px rgba(0,0,0,0.4);
        }
        
        .item-details {
            flex: 1;
        }
        
        .item-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quantity-btn {
            background: linear-gradient(145deg, #FF6B35, #e55a2b);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 
                inset 0 0 0 1px rgba(255,255,255,0.2),
                0 2px 0 #cc4822,
                0 4px 8px rgba(0,0,0,0.3);
        }
        
        .quantity-btn:hover {
            transform: translateY(-1px);
            box-shadow: 
                inset 0 0 0 1px rgba(255,255,255,0.4),
                0 3px 0 #cc4822,
                0 6px 12px rgba(0,0,0,0.4);
        }
        
        .quantity-btn:active {
            transform: translateY(1px);
            box-shadow: 
                inset 0 0 0 1px rgba(255,255,255,0.2),
                0 1px 0 #cc4822,
                0 2px 4px rgba(0,0,0,0.2);
        }
        
        .quantity {
            font-weight: bold;
            min-width: 30px;
            text-align: center;
        }
        
        .order-summary {
            background: linear-gradient(145deg, #2a2a5c, #1e1e42);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 
                inset 0 0 0 3px rgba(255,255,255,0.1),
                0 10px 30px rgba(0,0,0,0.5);
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .summary-total {
            font-size: 1.3em;
            font-weight: bold;
            color: #4CAF50;
            border-top: 2px solid rgba(76, 175, 80, 0.3);
            padding-top: 10px;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
        }
        
        .payment-section {
            background: linear-gradient(145deg, #1e1e42, #2a2a5c);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 
                inset 0 0 0 3px rgba(255,255,255,0.1),
                0 10px 30px rgba(0,0,0,0.5);
        }
        
        .payment-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: none;
            border-radius: 10px;
            background: linear-gradient(145deg, #333366, #2a2a5c);
            color: white;
            margin-bottom: 15px;
            box-shadow: 
                inset 0 0 0 2px rgba(255,255,255,0.1),
                inset 0 5px 15px rgba(0,0,0,0.3);
            font-family: 'Orbitron', monospace;
        }
        
        .payment-input:focus {
            outline: none;
            box-shadow: 
                inset 0 0 0 2px rgba(76, 175, 80, 0.5),
                inset 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .change-display {
            font-size: 1.2em;
            color: #4CAF50;
            font-weight: bold;
            text-align: center;
            margin-top: 15px;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
        }
        
        /* Receipt Modal */
        .receipt-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease-in;
        }
        
        .receipt {
            background: white;
            color: black;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            font-family: 'Courier New', monospace;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
            animation: bounceIn 0.6s ease-out;
        }
        
        .receipt-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px dashed #333;
            padding-bottom: 15px;
        }
        
        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .receipt-total {
            border-top: 2px dashed #333;
            padding-top: 10px;
            margin-top: 10px;
            font-weight: bold;
        }
        
        /* Scan Simulation Modal */
        .scan-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease-in;
        }
        
        .scan-content {
            background: linear-gradient(145deg, #1e1e42, #2a2a5c);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            color: white;
            box-shadow: 
                inset 0 0 0 3px rgba(255,255,255,0.1),
                0 20px 60px rgba(0,0,0,0.8);
            animation: bounceIn 0.6s ease-out;
        }
        
        .scan-animation {
            width: 100px;
            height: 100px;
            border: 4px solid #4CAF50;
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: scan-pulse 1.5s infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
        }
        
        @keyframes scan-pulse {
            0%, 100% { 
                border-color: #4CAF50;
                box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
            }
            50% { 
                border-color: #FF6B35;
                box-shadow: 0 0 30px rgba(255, 107, 53, 0.5);
            }
        }
        
        .hidden {
            display: none;
        }
        
        .visible {
            display: block;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .chart-stats {
                grid-template-columns: 1fr;
            }
            
            .order-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .order-item {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-page" id="loginPage">
        <div class="login-container">
            <div class="login-header">
                <h1>🏪 7-Evelyn POS</h1>
                <p>Cashier Login</p>
            </div>
            <div class="login-form">
                <div class="input-group">
                    <label for="cashierId">Email:</label>
                    <input type="email" id="cashierId" placeholder="Enter your email address" maxlength="100">
                </div>
                <div class="input-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" placeholder="Enter Password" maxlength="50">
                </div>
                <button class="pixel-btn" onclick="login()">Login</button>
                <button class="pixel-btn" onclick="requestPasswordReset()" style="background: linear-gradient(145deg, #FF6B35, #e55a2b); margin-top: 10px;">
                    🔑 Reset Password
                </button>
                <div class="error-message" id="loginError"></div>
            </div>
        </div>
    </div>
    
    <!-- Lockout Page -->
    <div class="lockout-page" id="lockoutPage" style="display: none;">
        <div class="lockout-container">
            <div class="lockout-header">
                <h1>🚫 ACCESS DENIED</h1>
                <p>Too many failed attempts</p>
            </div>
            <div class="lockout-message">
                <p>System locked due to multiple failed login attempts.</p>
                <p>Please contact administrator.</p>
                <button class="pixel-btn" onclick="showResetLogin()" style="background: linear-gradient(145deg, #f44336, #d32f2f);">
                    Reset System
                </button>
            </div>
        </div>
    </div>
    
    <!-- Reset Login Page -->
    <div class="reset-login-page" id="resetLoginPage" style="display: none;">
        <div class="reset-login-container">
            <div class="reset-login-header">
                <h1>🔓 SYSTEM RESET</h1>
                <p>Administrator Access Required</p>
            </div>
            <div class="reset-login-form">
                <div class="input-group">
                    <label for="resetCashierId">Admin Email:</label>
                    <input type="email" id="resetCashierId" placeholder="Enter Admin Email" maxlength="100">
                </div>
                <div class="input-group">
                    <label for="resetPassword">Admin Password:</label>
                    <input type="password" id="resetPassword" placeholder="Enter Admin Password" maxlength="50">
                </div>
                <button class="pixel-btn" onclick="resetSystem()" style="background: linear-gradient(145deg, #f44336, #d32f2f);">
                    Reset System
                </button>
                <div class="error-message" id="resetError"></div>
            </div>
        </div>
    </div>
    
    <!-- PIN Code Modal -->
    <div class="pin-modal" id="pinModal" style="display: none;">
        <div class="pin-container">
            <div class="pin-header">
                <h3>🔐 Security PIN Required</h3>
                <p>Enter 6-digit PIN to complete order</p>
            </div>
            <div class="pin-input-container">
                <input type="password" id="pinInput" maxlength="6" placeholder="000000">
                <div class="pin-display" id="pinDisplay">••••••</div>
            </div>
            <div class="pin-attempts">
                <span id="pinAttempts">Attempts: 0/3</span>
            </div>
            <div class="pin-buttons">
                <button class="pixel-btn" onclick="verifyPin()">Verify PIN</button>
                <button class="pixel-btn" onclick="cancelPin()" style="background: linear-gradient(145deg, #f44336, #d32f2f);">Cancel</button>
            </div>
            <div class="pin-error" id="pinError"></div>
        </div>
    </div>
    
    <!-- Sleep Mode -->
    <div class="sleep-mode" id="sleepMode">
        <div class="sleep-text">💤 Double-tap to wake up</div>
    </div>
    
    <!-- Homepage -->
    <div class="homepage" id="homepage">
        <div class="container">
            <div class="header">
                <h1>🏪 7-Evelyn POS</h1>
                <p>RFID-Based Point of Sale System</p>
            </div>
            
            <div class="chart-section">
                <div class="chart-title">📊 Summary</div>
                <div class="chart-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalSales">$0</div>
                        <div class="stat-label">💰 Sales</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="itemsSold">0</div>
                        <div class="stat-label">📦 Items</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="transactions">0</div>
                        <div class="stat-label">🔄 Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgTransaction">$0</div>
                        <div class="stat-label">📈 Average</div>
                    </div>
                </div>
            </div>
            
            <div class="products-section">
                <div class="section-title">🛍️ Products</div>
                <div class="products-grid" id="productsGrid">
                    <!-- Products will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Floating Cart -->
    <div class="floating-cart" id="floatingCart" style="display: none;">
        <div class="cart-toggle" onclick="toggleCart()">
            <span class="cart-icon">🛒</span>
            <span class="cart-count" id="floatingCartCount">0</span>
        </div>
        <div class="cart-content" id="cartContent">
            <div class="cart-header">
                <h4>Cart Summary</h4>
                <button class="close-cart" onclick="toggleCart()">×</button>
            </div>
            <div class="cart-items" id="cartItems">
                <!-- Cart items will be populated here -->
            </div>
            <div class="cart-footer">
                <div class="cart-total" id="cartTotal">Total: ₱0.00</div>
                <button class="pixel-btn" onclick="proceedToOrder()" style="width: 100%; margin-top: 10px;">
                    Proceed to Order
                </button>
            </div>
        </div>
    </div>
    
    <!-- Floating Account Section -->
    <div class="floating-account" id="floatingAccount">
        <div class="account-toggle" onclick="toggleAccount()">
            <span class="account-icon">👤</span>
        </div>
        <div class="account-content" id="accountContent">
            <div class="account-header">
                <h4>Account</h4>
                <button class="close-account" onclick="toggleAccount()">×</button>
            </div>
            <div class="account-info">
                <div class="cashier-display">
                    <span class="cashier-label">Cashier:</span>
                    <span class="cashier-name" id="currentCashier">El121703</span>
                </div>
                <div class="account-actions">
                    <button class="pixel-btn" onclick="showHistory()" style="width: 100%; margin-bottom: 10px;">
                        📋 History
                    </button>
                    <button class="pixel-btn" onclick="logout()" style="width: 100%; background: linear-gradient(145deg, #f44336, #d32f2f);">
                        🚪 Logout
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- History Section -->
    <div class="history-page" id="historyPage" style="display: none;">
        <div class="container">
            <div class="history-header">
                <h2>📋 Transaction History</h2>
                <button class="pixel-btn" onclick="hideHistory()">← Back to POS</button>
            </div>
            <div class="history-filters">
                <div class="filter-group">
                    <label>Date Range:</label>
                    <input type="date" id="startDate">
                    <input type="date" id="endDate">
                </div>
                <div class="filter-group">
                    <label>Search:</label>
                    <input type="text" id="searchInput" placeholder="Search by receipt ID or cashier">
                </div>
            </div>
            <div class="history-list" id="historyList">
                <!-- Transaction history will be populated here -->
            </div>
        </div>
    </div>
    
    <!-- Order/Scanned Page -->
    <div class="order-page" id="orderPage">
        <div class="container">
            <div class="order-header">
                <h2>🛒 Current Order</h2>
                <button class="pixel-btn" onclick="goToHomepage()">← Back to Products</button>
            </div>
            
            <div class="order-items" id="orderItems">
                <!-- Order items will be populated by JavaScript -->
            </div>
            
            <div class="order-summary" id="orderSummary">
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span id="subtotal">$0.00</span>
                </div>
                <div class="summary-row">
                    <span>VAT (12%):</span>
                    <span id="vat">$0.00</span>
                </div>
                <div class="summary-row summary-total">
                    <span>Total:</span>
                    <span id="total">$0.00</span>
                </div>
            </div>
            
            <div class="payment-section">
                <h3>💳 Payment</h3>
                <input type="number" class="payment-input" id="paymentAmount" placeholder="Enter payment amount" step="0.01">
                <div class="change-display" id="changeDisplay"></div>
                <button class="pixel-btn" onclick="processPayment()" id="proceedBtn" disabled>Proceed to Payment</button>
            </div>
        </div>
    </div>
    
    <!-- Scan Simulation Modal -->
    <div class="scan-modal" id="scanModal">
        <div class="scan-content">
            <div class="scan-animation">📡</div>
            <h3>RFID Detected!</h3>
            <p id="scannedProductName">Product Name</p>
            <p>Simulating RFID scan...</p>
            <button class="pixel-btn" onclick="continueToOrder()" style="margin-top: 20px;">Continue to Order</button>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3 id="loadingText">Processing...</h3>
            <p id="loadingSubtext">Please wait while we process your request</p>
        </div>
    </div>
    
    <!-- RFID Setup Modal -->
    <div class="rfid-setup-modal" id="rfidSetupModal">
        <div class="rfid-setup-container">
            <div class="rfid-setup-header">
                <h3>🔧 RFID Setup</h3>
                <p>Configure RFID ID for this device</p>
            </div>
            <div class="rfid-input-container">
                <input type="text" id="rfidIdInput" placeholder="Enter RFID ID" maxlength="20">
            </div>
            <div class="pin-buttons">
                <button class="pixel-btn" onclick="saveRfidId()">Save RFID ID</button>
                <button class="pixel-btn" onclick="cancelRfidSetup()" style="background: linear-gradient(145deg, #f44336, #d32f2f);">Cancel</button>
            </div>
            <div class="pin-error" id="rfidError"></div>
        </div>
    </div>
    
    <!-- Receipt Modal -->
    <div class="receipt-modal" id="receiptModal">
        <div class="receipt">
            <div class="receipt-header">
                <h2>🏪 7-EVELYN</h2>
                <p>Digital Receipt</p>
                <p id="receiptId" style="font-weight: bold; color: #333;"></p>
                <p id="receiptDate"></p>
            </div>
            <div id="receiptItems"></div>
            <div class="receipt-total">
                <div class="receipt-item">
                    <span>Subtotal:</span>
                    <span id="receiptSubtotal">$0.00</span>
                </div>
                <div class="receipt-item">
                    <span>VAT (12%):</span>
                    <span id="receiptVAT">$0.00</span>
                </div>
                <div class="receipt-item" style="font-size: 1.2em;">
                    <span>TOTAL:</span>
                    <span id="receiptTotal">$0.00</span>
                </div>
                <div class="receipt-item">
                    <span>Payment:</span>
                    <span id="receiptPayment">$0.00</span>
                </div>
                <div class="receipt-item">
                    <span>Change:</span>
                    <span id="receiptChange">$0.00</span>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="pixel-btn" id="receiptCloseBtn" onclick="closeReceipt()">OK - Return to Homepage</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: 'AIzaSyBtclnP5Dm8Sgnsz7KbsOjxLCmmuVDleaA',
            authDomain: 'seven-evelyn.firebaseapp.com',
            databaseURL: 'https://seven-evelyn-default-rtdb.asia-southeast1.firebasedatabase.app',
            projectId: 'seven-evelyn',
            storageBucket: 'seven-evelyn.appspot.com',
            messagingSenderId: '590690127841',
            appId: '1:590690127841:web:your-app-id'
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        
        // Global variables
        let currentUser = null;
        let rfidId = null;
        let isRfidConfigured = false;
        let isLoggingIn = false; // Prevent multiple login attempts
        
        // Sample product data (will be loaded from Firebase)
        const products = [
            { id: "bananas", name: "Bananas", price: 89.99, stock: 50, emoji: "🍌" },
            { id: "apples", name: "Apples", price: 104.99, stock: 30, emoji: "🍎" },
            { id: "bread", name: "Bread", price: 75.00, stock: 25, emoji: "🍞" },
            { id: "milk", name: "Milk", price: 149.99, stock: 20, emoji: "🥛" },
            { id: "eggs", name: "Eggs", price: 119.99, stock: 35, emoji: "🥚" },
            { id: "chicken", name: "Chicken", price: 269.99, stock: 15, emoji: "🍗" },
            { id: "rice", name: "Rice", price: 164.99, stock: 40, emoji: "🍚" },
            { id: "tomatoes", name: "Tomatoes", price: 119.99, stock: 28, emoji: "🍅" },
            { id: "cheese", name: "Cheese", price: 209.99, stock: 18, emoji: "🧀" },
            { id: "cereal", name: "Cereal", price: 134.99, stock: 22, emoji: "🥣" },
            { id: "orange-juice", name: "Orange Juice", price: 119.99, stock: 16, emoji: "🧃" },
            { id: "pasta", name: "Pasta", price: 89.99, stock: 33, emoji: "🍝" }
        ];
        
        let currentOrder = [];
        let cart = [];
        let dailyStats = {
            totalSales: 0,
            itemsSold: 0,
            transactions: 0
        };
        
        let sleepTimer;
        let currentScannedProduct = null;
        
        // Transaction history
        let transactionHistory = [];
        let currentReceiptId = '';
        
        // Security variables
        let isLoggedIn = false;
        let loginAttempts = 0;
        let maxLoginAttempts = 3;
        let isLockedOut = false;
        let pinAttempts = 0;
        let maxPinAttempts = 3;
        
        // Credentials
        const validCredentials = {
            cashierId: 'cadangjohnlloyd92@gmail.com',
            password: 'Admin123',
            pin: '123456',
            adminId: 'Admin',
            adminPassword: 'Reset123'
        };
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            createParticles();
            
            // Initialize Firebase and check authentication state
            initializeFirebase();
            
            // Load transaction history from Firebase
            loadTransactionHistory();
            
            // Check if RFID is configured
            checkRfidConfiguration();
            
            // Show login page first
            showLoginPage();
            
            // Add payment input listener
            document.getElementById('paymentAmount').addEventListener('input', calculateChange);
            
            // Sleep mode double-tap listener
            document.getElementById('sleepMode').addEventListener('dblclick', wakeUp);
            
            // Reset sleep timer on user activity
            document.addEventListener('click', resetSleepTimer);
            document.addEventListener('keypress', resetSleepTimer);
            document.addEventListener('mousemove', resetSleepTimer);
            
            // Add enter key support for login
            document.getElementById('cashierId').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('password').focus();
                }
            });
            
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
            
            // Add enter key support for PIN
            document.getElementById('pinInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    verifyPin();
                }
            });
            
            // Add integer-only validation for PIN
            document.getElementById('pinInput').addEventListener('input', function(e) {
                // Remove any non-numeric characters
                this.value = this.value.replace(/[^0-9]/g, '');
                
                // Update the display dots
                const display = document.getElementById('pinDisplay');
                const length = this.value.length;
                display.textContent = '•'.repeat(length) + '•'.repeat(6 - length);
            });
            
            // Add event listeners for history filters
            document.getElementById('startDate').addEventListener('change', renderHistory);
            document.getElementById('endDate').addEventListener('change', renderHistory);
            document.getElementById('searchInput').addEventListener('input', renderHistory);
            
            // Add event listeners for RFID setup modal
            document.getElementById('rfidIdInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    saveRfidId();
                }
            });
            
            // Listen for product scans from Firebase database
            // Note: Database listener will be set up after products are loaded
        });
        
        // Create floating particles
        function createParticles() {
            const particlesContainer = document.createElement('div');
            particlesContainer.className = 'particles';
            document.body.appendChild(particlesContainer);
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    createParticle(particlesContainer);
                }, i * 300);
            }
            
            // Continuously create new particles
            setInterval(() => {
                createParticle(particlesContainer);
            }, 2000);
        }
        
        function createParticle(container) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDelay = Math.random() * 2 + 's';
            particle.style.animationDuration = (Math.random() * 3 + 4) + 's';
            container.appendChild(particle);
            
            // Remove particle after animation
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 6000);
        }
        
        // Sleep mode functionality
        function startSleepTimer() {
            sleepTimer = setTimeout(goToSleep, 300000); // 5 minutes
        }
        
        function resetSleepTimer() {
            clearTimeout(sleepTimer);
            startSleepTimer();
        }
        
        function goToSleep() {
            document.getElementById('sleepMode').style.display = 'flex';
        }
        
        function wakeUp() {
            document.getElementById('sleepMode').style.display = 'none';
            resetSleepTimer();
        }
        
        // Render products on homepage
        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                if (isRfidConfigured) {
                    productCard.classList.add('rfid-ready');
                }
                productCard.innerHTML = `
                    <div class="product-image">${product.emoji}</div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">₱${product.price.toFixed(2)}</div>
                    <div class="product-stock">📦 ${product.stock}</div>
                    <div class="product-status" id="productStatus${product.id}">
                        <span class="rfid-indicator">${isRfidConfigured ? '📡 Ready for RFID' : '⚠️ RFID Not Configured'}</span>
                    </div>
                `;
                
                // Add click event to simulate RFID scan
                productCard.addEventListener('click', () => {
                    scanProduct(product.id);
                });
                
                grid.appendChild(productCard);
            });
        }
        
        // Firebase initialization
        function initializeFirebase() {
            // Listen for authentication state changes
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    console.log('User signed in:', user.email);
                } else {
                    currentUser = null;
                    console.log('User signed out');
                }
            });
        }
        
        // Check RFID configuration
        function checkRfidConfiguration() {
            rfidId = localStorage.getItem('rfidId');
            if (rfidId) {
                isRfidConfigured = true;
                console.log('RFID configured:', rfidId);
            } else {
                isRfidConfigured = false;
                console.log('RFID not configured');
            }
        }
        
        // Show loading overlay
        function showLoading(text = 'Processing...', subtext = 'Please wait while we process your request') {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingSubtext').textContent = subtext;
            document.getElementById('loadingOverlay').style.display = 'flex';
            
            // Set a timeout to automatically hide loading after 30 seconds
            setTimeout(() => {
                if (document.getElementById('loadingOverlay').style.display === 'flex') {
                    console.warn('Loading timeout - hiding loading screen');
                    hideLoading();
                }
            }, 30000);
        }
        
        // Hide loading overlay
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        // Login functions
        function showLoginPage() {
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('homepage').style.display = 'none';
            document.getElementById('orderPage').style.display = 'none';
            document.getElementById('floatingCart').style.display = 'none';
        }
        
        async function login() {
            const email = document.getElementById('cashierId').value;
            const password = document.getElementById('password').value;
            const errorElement = document.getElementById('loginError');
            
            // Prevent multiple login attempts
            if (isLoggedIn || isLoggingIn) {
                console.log('Already logged in or login in progress, skipping login attempt');
                return;
            }
            
            isLoggingIn = true;
            
            if (isLockedOut) {
                errorElement.textContent = 'System is locked. Please contact administrator.';
                return;
            }
            
            if (!email || !password) {
                errorElement.textContent = 'Please enter both email and password.';
                return;
            }
            
            showLoading('Authenticating...', 'Verifying credentials with Firebase');
            
            try {
                // Try Firebase authentication with the provided email
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                console.log('Firebase auth successful:', user.email);
                
                // Check if this is first login (no PINCODE set)
                const userRef = database.ref(`users/${user.uid}`);
                const snapshot = await userRef.once('value');
                const userData = snapshot.val();
                console.log('User data from database:', userData);
                
                if (!userData || !userData.pincode) {
                    // First time login - need to set PINCODE
                    console.log('First time user, showing PINCODE setup modal');
                    hideLoading();
                    showPincodeSetupModal(email);
                    return;
                }
                
                // Successful login with existing PINCODE
                isLoggedIn = true;
                currentUser = user;
                loginAttempts = 0;
                document.getElementById('currentCashier').textContent = userData.cashierId || email;
                
                // Hide login page and show homepage
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('homepage').style.display = 'block';
                
                // Initialize POS system
                try {
                    await loadProductsFromFirebase();
                } catch (error) {
                    console.error('Error loading products:', error);
                    // Continue with default products if Firebase fails
                }
                
                renderProducts();
                updateDailyStats();
                startSleepTimer();
                
                // Add fade-in animation to main content
                document.querySelector('.container').classList.add('fade-in');
                
                resetSleepTimer();
                hideLoading();
                
                // Load user-specific transaction history
                await loadUserTransactionHistory();
                
                // Setup database listener AFTER products are loaded
                setupRFIDDatabaseListener();
                
            } catch (error) {
                hideLoading();
                isLoggingIn = false;
                console.error('Login error:', error);
                
                // Fallback to local authentication for demo
                if (email === validCredentials.cashierId && password === validCredentials.password) {
                    isLoggedIn = true;
                    isLoggingIn = false;
                    loginAttempts = 0;
                    document.getElementById('currentCashier').textContent = email;
                    
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('homepage').style.display = 'block';
                    
                renderProducts();
                updateDailyStats();
                startSleepTimer();
                
                document.querySelector('.container').classList.add('fade-in');
                resetSleepTimer();
                hideLoading();
                
                // Load user-specific transaction history
                await loadUserTransactionHistory();
                
                // Setup database listener AFTER products are loaded
                setupRFIDDatabaseListener();
                } else {
                    // Failed login
                    isLoggingIn = false;
                    loginAttempts++;
                    errorElement.textContent = `Invalid credentials. Attempts: ${loginAttempts}/${maxLoginAttempts}`;
                    
                    if (loginAttempts >= maxLoginAttempts) {
                        isLockedOut = true;
                        showLockoutPage();
                    }
                }
            }
        }
        
        function logout() {
            isLoggedIn = false;
            isLoggingIn = false;
            currentUser = null;
            currentOrder = [];
            cart = [];
            updateCartDisplay();
            showLoginPage();
        }
        
        // Account management functions
        function toggleAccount() {
            const accountContent = document.getElementById('accountContent');
            if (accountContent.style.display === 'block') {
                accountContent.style.display = 'none';
            } else {
                accountContent.style.display = 'block';
            }
        }
        
        // History management functions
        function showHistory() {
            document.getElementById('homepage').style.display = 'none';
            document.getElementById('orderPage').style.display = 'none';
            document.getElementById('historyPage').style.display = 'block';
            document.getElementById('floatingCart').style.display = 'none';
            document.getElementById('floatingAccount').style.display = 'none';
            
            // Set default date range to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').value = today;
            document.getElementById('endDate').value = today;
            
            renderHistory();
            resetSleepTimer();
        }
        
        function hideHistory() {
            document.getElementById('historyPage').style.display = 'none';
            document.getElementById('homepage').style.display = 'block';
            document.getElementById('floatingCart').style.display = 'block';
            document.getElementById('floatingAccount').style.display = 'block';
            resetSleepTimer();
        }
        
        async function loadTransactionHistory() {
            try {
                if (!currentUser) {
                    console.log('No user logged in, skipping transaction history load');
                    transactionHistory = [];
                    return;
                }
                
                const historyRef = database.ref(`transactions/${currentUser.uid}`);
                const snapshot = await historyRef.once('value');
                const data = snapshot.val();
                
                if (data) {
                    transactionHistory = Object.values(data);
                } else {
                    transactionHistory = [];
                }
                
                console.log(`Loaded ${transactionHistory.length} transactions for user ${currentUser.email}`);
            } catch (error) {
                console.error('Error loading transaction history:', error);
                // Fallback to localStorage
                const saved = localStorage.getItem(`transactionHistory_${currentUser?.uid || 'guest'}`);
                if (saved) {
                    transactionHistory = JSON.parse(saved);
                } else {
                    transactionHistory = [];
                }
            }
        }
        
        async function saveTransactionHistory() {
            try {
                if (!currentUser) {
                    console.log('No user logged in, saving to localStorage');
                    localStorage.setItem('transactionHistory_guest', JSON.stringify(transactionHistory));
                    return;
                }
                
                const transactionRef = database.ref(`transactions/${currentUser.uid}`);
                await transactionRef.set(transactionHistory);
                
                console.log(`Saved ${transactionHistory.length} transactions for user ${currentUser.email}`);
            } catch (error) {
                console.error('Error saving transaction history:', error);
                // Fallback to localStorage
                localStorage.setItem(`transactionHistory_${currentUser?.uid || 'guest'}`, JSON.stringify(transactionHistory));
            }
        }
        
        // Load transaction history when user logs in
        async function loadUserTransactionHistory() {
            if (currentUser) {
                await loadTransactionHistory();
                console.log(`Transaction history loaded for ${currentUser.email}`);
            }
        }
        
        function generateUniqueId() {
            const timestamp = Date.now().toString(36);
            const random = Math.random().toString(36).substr(2, 5);
            return `RCP-${timestamp}-${random}`.toUpperCase();
        }
        
        // Load products from Firebase
        async function loadProductsFromFirebase() {
            try {
                // Add timeout to prevent hanging
                const timeoutPromise = new Promise((_, reject) => 
                    setTimeout(() => reject(new Error('Firebase timeout')), 10000)
                );
                
                const productsRef = database.ref('products');
                const snapshot = await Promise.race([
                    productsRef.once('value'),
                    timeoutPromise
                ]);
                const data = snapshot.val();
                
                if (data) {
                    // Convert Firebase data to products array
                    products.length = 0; // Clear existing products
                    Object.keys(data).forEach(key => {
                        products.push({ id: key, ...data[key] });
                    });
                    console.log('Products loaded from Firebase:', products.length);
                } else {
                    // Initialize with default products if none exist
                    await initializeDefaultProducts();
                }
            } catch (error) {
                console.error('Error loading products:', error);
                // Use default products if Firebase fails
                products.length = 0;
                const defaultProducts = [
                    { id: "bananas", name: "Bananas", price: 89.99, stock: 50, emoji: "🍌" },
                    { id: "apples", name: "Apples", price: 104.99, stock: 30, emoji: "🍎" },
                    { id: "bread", name: "Bread", price: 75.00, stock: 25, emoji: "🍞" },
                    { id: "milk", name: "Milk", price: 149.99, stock: 20, emoji: "🥛" },
                    { id: "eggs", name: "Eggs", price: 119.99, stock: 35, emoji: "🥚" },
                    { id: "chicken", name: "Chicken", price: 269.99, stock: 15, emoji: "🍗" },
                    { id: "rice", name: "Rice", price: 164.99, stock: 40, emoji: "🍚" },
                    { id: "tomatoes", name: "Tomatoes", price: 119.99, stock: 28, emoji: "🍅" },
                    { id: "cheese", name: "Cheese", price: 209.99, stock: 18, emoji: "🧀" },
                    { id: "cereal", name: "Cereal", price: 134.99, stock: 22, emoji: "🥣" },
                    { id: "orange-juice", name: "Orange Juice", price: 119.99, stock: 16, emoji: "🧃" },
                    { id: "pasta", name: "Pasta", price: 89.99, stock: 33, emoji: "🍝" }
                ];
                products.push(...defaultProducts);
                console.log('Using default products:', products.length);
            }
        }
        
        // Initialize default products in Firebase
        async function initializeDefaultProducts() {
            try {
                const productsRef = database.ref('products');
                const defaultProducts = {
                    "bananas": { name: "Bananas", price: 89.99, stock: 50, emoji: "🍌" },
                    "apples": { name: "Apples", price: 104.99, stock: 30, emoji: "🍎" },
                    "bread": { name: "Bread", price: 75.00, stock: 25, emoji: "🍞" },
                    "milk": { name: "Milk", price: 149.99, stock: 20, emoji: "🥛" },
                    "eggs": { name: "Eggs", price: 119.99, stock: 35, emoji: "🥚" },
                    "chicken": { name: "Chicken", price: 269.99, stock: 15, emoji: "🍗" },
                    "rice": { name: "Rice", price: 164.99, stock: 40, emoji: "🍚" },
                    "tomatoes": { name: "Tomatoes", price: 119.99, stock: 28, emoji: "🍅" },
                    "cheese": { name: "Cheese", price: 209.99, stock: 18, emoji: "🧀" },
                    "cereal": { name: "Cereal", price: 134.99, stock: 22, emoji: "🥣" },
                    "orange-juice": { name: "Orange Juice", price: 119.99, stock: 16, emoji: "🧃" },
                    "pasta": { name: "Pasta", price: 89.99, stock: 33, emoji: "🍝" }
                };
                
                await productsRef.set(defaultProducts);
                
                // Update local products array
                products.length = 0;
                Object.keys(defaultProducts).forEach(key => {
                    products.push({ id: key, ...defaultProducts[key] });
                });
            } catch (error) {
                console.error('Error initializing default products:', error);
            }
        }
        
        // Update product stock in Firebase
        async function updateProductStock(productId, newStock) {
            try {
                const productRef = database.ref(`products/${productId}/stock`);
                await productRef.set(newStock);
            } catch (error) {
                console.error('Error updating product stock:', error);
            }
        }
        
        // Show PINCODE setup modal for first-time users
        function showPincodeSetupModal(email) {
            console.log('Showing PINCODE setup modal for:', email);
            const pinModal = document.getElementById('pinModal');
            const pinHeader = pinModal.querySelector('.pin-header h3');
            const pinSubtext = pinModal.querySelector('.pin-header p');
            
            pinHeader.textContent = '🔐 Setup PINCODE';
            pinSubtext.textContent = `Set your 6-digit PINCODE for security\nEmail: ${email}`;
            
            pinAttempts = 0;
            document.getElementById('pinInput').value = '';
            document.getElementById('pinDisplay').textContent = '••••••';
            document.getElementById('pinAttempts').textContent = 'Setup PINCODE';
            document.getElementById('pinError').textContent = '';
            
            // Change the verify button to setup
            const verifyBtn = pinModal.querySelector('.pin-buttons .pixel-btn:first-child');
            verifyBtn.textContent = 'Setup PINCODE';
            verifyBtn.onclick = () => setupPincode(email);
            
            // Hide login page and show PIN modal
            document.getElementById('loginPage').style.display = 'none';
            pinModal.style.display = 'flex';
            document.getElementById('pinInput').focus();
            
            console.log('PINCODE modal should now be visible');
        }
        
        // Setup PINCODE for first-time user
        async function setupPincode(email) {
            const enteredPin = document.getElementById('pinInput').value;
            const errorElement = document.getElementById('pinError');
            
            if (enteredPin.length !== 6 || !/^\d{6}$/.test(enteredPin)) {
                errorElement.textContent = 'PINCODE must be exactly 6 digits.';
                return;
            }
            
            showLoading('Setting up PINCODE...', 'Saving to database');
            
            try {
                // Extract cashier ID from email (part before @)
                const cashierId = email.split('@')[0];
                
                // Get current user from auth state
                const user = auth.currentUser;
                if (!user) {
                    throw new Error('User not authenticated');
                }
                
                // Save user data to Firebase
                const userRef = database.ref(`users/${user.uid}`);
                await userRef.set({
                    email: email,
                    cashierId: cashierId,
                    pincode: enteredPin,
                    createdAt: firebase.database.ServerValue.TIMESTAMP,
                    lastLogin: firebase.database.ServerValue.TIMESTAMP
                });
                
                hideLoading();
                document.getElementById('pinModal').style.display = 'none';
                
                // Complete login process
                isLoggedIn = true;
                isLoggingIn = false;
                currentUser = user;
                loginAttempts = 0;
                document.getElementById('currentCashier').textContent = cashierId;
                
                // Hide PIN modal and show homepage
                document.getElementById('pinModal').style.display = 'none';
                document.getElementById('homepage').style.display = 'block';
                
                try {
                    await loadProductsFromFirebase();
                } catch (error) {
                    console.error('Error loading products:', error);
                }
                
                renderProducts();
                updateDailyStats();
                startSleepTimer();
                
                document.querySelector('.container').classList.add('fade-in');
                resetSleepTimer();
                
            } catch (error) {
                hideLoading();
                console.error('Error setting up PINCODE:', error);
                errorElement.textContent = 'Error setting up PINCODE. Please try again.';
            }
        }
        
        // Show RFID setup modal
        function showRfidSetupModal() {
            document.getElementById('rfidSetupModal').style.display = 'flex';
            document.getElementById('rfidIdInput').focus();
        }
        
        // Save RFID ID (simplified - no longer needed for basic functionality)
        function saveRfidId() {
            const rfidIdInput = document.getElementById('rfidIdInput').value.trim();
            const errorElement = document.getElementById('rfidError');
            
            if (!rfidIdInput) {
                errorElement.textContent = 'Please enter an RFID ID.';
                return;
            }
            
            rfidId = rfidIdInput;
            isRfidConfigured = true;
            localStorage.setItem('rfidId', rfidId);
            
            document.getElementById('rfidSetupModal').style.display = 'none';
            
            // Show success message
            showCartFeedback({ name: 'RFID ID configured successfully!' });
        }
        
        // Cancel RFID setup
        function cancelRfidSetup() {
            document.getElementById('rfidSetupModal').style.display = 'none';
        }
        
        // Password reset functionality - Admin only
        async function requestPasswordReset() {
            const email = document.getElementById('cashierId').value;
            const password = document.getElementById('password').value;
            
            if (!email) {
                alert('Please enter your email address first.');
                return;
            }
            
            // Check if user is admin
            if (email !== 'cadangjohnlloyd92@gmail.com') {
                alert('Password reset is only available for administrators.\nPlease contact: cadangjohnlloyd92@gmail.com');
                return;
            }
            
            // Verify admin password
            if (!password) {
                alert('Please enter your password to verify admin access.');
                return;
            }
            
            showLoading('Verifying admin access...', 'Checking administrator credentials');
            
            try {
                // Verify admin credentials
                await auth.signInWithEmailAndPassword(email, password);
                
                // Send password reset email to admin
                await auth.sendPasswordResetEmail(email);
                
                // Sign out after sending reset email
                await auth.signOut();
                
                hideLoading();
                alert('Password reset email sent to administrator (cadangjohnlloyd92@gmail.com)\nPlease check your email and follow the reset instructions.');
                
                // Clear the password field for security
                document.getElementById('password').value = '';
                
            } catch (error) {
                hideLoading();
                console.error('Password reset error:', error);
                
                if (error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found') {
                    alert('Invalid admin credentials. Password reset is only available for administrators.');
                } else {
                    alert('Error sending password reset request. Please try again or contact support.');
                }
            }
        }
        
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            // Filter transactions
            let filteredHistory = transactionHistory.filter(transaction => {
                const transactionDate = new Date(transaction.date).toISOString().split('T')[0];
                const matchesDate = (!startDate || transactionDate >= startDate) && 
                                  (!endDate || transactionDate <= endDate);
                const matchesSearch = !searchTerm || 
                                    transaction.receiptId.toLowerCase().includes(searchTerm) ||
                                    transaction.cashier.toLowerCase().includes(searchTerm);
                return matchesDate && matchesSearch;
            });
            
            // Sort by date (newest first)
            filteredHistory.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            historyList.innerHTML = '';
            
            if (filteredHistory.length === 0) {
                historyList.innerHTML = '<div style="text-align: center; opacity: 0.7; padding: 40px;">No transactions found</div>';
                return;
            }
            
            filteredHistory.forEach(transaction => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-item-header">
                        <div class="receipt-id">${transaction.receiptId}</div>
                        <div class="receipt-date">${new Date(transaction.date).toLocaleString()}</div>
                    </div>
                    <div class="history-item-details">
                        <div class="detail-item">
                            <div class="detail-label">Cashier</div>
                            <div class="detail-value">${transaction.cashier}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Items</div>
                            <div class="detail-value">${transaction.items.length}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Total</div>
                            <div class="detail-value">₱${transaction.total.toFixed(2)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Payment</div>
                            <div class="detail-value">₱${transaction.payment.toFixed(2)}</div>
                        </div>
                    </div>
                    <div class="history-item-actions">
                        <button class="view-receipt-btn" onclick="viewReceipt('${transaction.receiptId}')">
                            📄 View Receipt
                        </button>
                    </div>
                `;
                historyList.appendChild(historyItem);
            });
        }
        
        function viewReceipt(receiptId) {
            const transaction = transactionHistory.find(t => t.receiptId === receiptId);
            if (transaction) {
                // Generate receipt display
                generateReceiptFromHistory(transaction);
                
                // Change button text for history view
                document.getElementById('receiptCloseBtn').textContent = 'OK - Close';
                
                document.getElementById('receiptModal').style.display = 'flex';
            }
        }
        
        function generateReceiptFromHistory(transaction) {
            const receiptItems = document.getElementById('receiptItems');
            const now = new Date(transaction.date);
            
            document.getElementById('receiptDate').textContent = now.toLocaleString();
            document.getElementById('receiptId').textContent = transaction.receiptId;
            
            receiptItems.innerHTML = '';
            transaction.items.forEach(item => {
                const receiptItem = document.createElement('div');
                receiptItem.className = 'receipt-item';
                receiptItem.innerHTML = `
                    <span>${item.name} x${item.quantity}</span>
                    <span>₱${(item.price * item.quantity).toFixed(2)}</span>
                `;
                receiptItems.appendChild(receiptItem);
            });
            
            document.getElementById('receiptSubtotal').textContent = `₱${transaction.subtotal.toFixed(2)}`;
            document.getElementById('receiptVAT').textContent = `₱${transaction.vat.toFixed(2)}`;
            document.getElementById('receiptTotal').textContent = `₱${transaction.total.toFixed(2)}`;
            document.getElementById('receiptPayment').textContent = `₱${transaction.payment.toFixed(2)}`;
            document.getElementById('receiptChange').textContent = `₱${transaction.change.toFixed(2)}`;
        }
        
        function showLockoutPage() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('lockoutPage').style.display = 'flex';
        }
        
        function showResetLogin() {
            document.getElementById('lockoutPage').style.display = 'none';
            document.getElementById('resetLoginPage').style.display = 'flex';
        }
        
        function resetSystem() {
            const adminEmail = document.getElementById('resetCashierId').value;
            const adminPassword = document.getElementById('resetPassword').value;
            const errorElement = document.getElementById('resetError');
            
            if (adminEmail === validCredentials.cashierId && adminPassword === validCredentials.password) {
                // Successful reset
                isLockedOut = false;
                loginAttempts = 0;
                pinAttempts = 0;
                document.getElementById('resetLoginPage').style.display = 'none';
                showLoginPage();
            } else {
                errorElement.textContent = 'Invalid administrator credentials.';
            }
        }
        
        function resetLockout() {
            isLockedOut = false;
            loginAttempts = 0;
            document.getElementById('lockoutPage').style.display = 'none';
            showLoginPage();
        }
        
        // PIN functions
        function showPinModal() {
            pinAttempts = 0;
            document.getElementById('pinInput').value = '';
            document.getElementById('pinDisplay').textContent = '••••••';
            document.getElementById('pinAttempts').textContent = 'Attempts: 0/3';
            document.getElementById('pinError').textContent = '';
            document.getElementById('pinModal').style.display = 'flex';
            document.getElementById('pinInput').focus();
        }
        
        async function verifyPin() {
            const enteredPin = document.getElementById('pinInput').value;
            const errorElement = document.getElementById('pinError');
            const attemptsElement = document.getElementById('pinAttempts');
            
            showLoading('Verifying PIN...', 'Checking with database');
            
            try {
                // Get current user from auth state
                const user = auth.currentUser;
                if (!user) {
                    throw new Error('User not authenticated');
                }
                
                // Check PIN in Firebase
                const userRef = database.ref(`users/${user.uid}`);
                const snapshot = await userRef.once('value');
                const userData = snapshot.val();
                
                hideLoading();
                
                if (userData && userData.pincode === enteredPin) {
                    // Correct PIN
                    document.getElementById('pinModal').style.display = 'none';
                    processOrderWithPin();
                } else {
                    // Incorrect PIN
                    pinAttempts++;
                    attemptsElement.textContent = `Attempts: ${pinAttempts}/${maxPinAttempts}`;
                    errorElement.textContent = 'Incorrect PIN. Please try again.';
                    document.getElementById('pinInput').value = '';
                    document.getElementById('pinDisplay').textContent = '••••••';
                    
                    if (pinAttempts >= maxPinAttempts) {
                        // Too many failed attempts
                        document.getElementById('pinModal').style.display = 'none';
                        showLockoutPage();
                    }
                }
            } catch (error) {
                hideLoading();
                console.error('Error verifying PIN:', error);
                
                // Fallback to local verification
                if (enteredPin === validCredentials.pin) {
                    document.getElementById('pinModal').style.display = 'none';
                    processOrderWithPin();
                } else {
                    pinAttempts++;
                    attemptsElement.textContent = `Attempts: ${pinAttempts}/${maxPinAttempts}`;
                    errorElement.textContent = 'Incorrect PIN. Please try again.';
                    document.getElementById('pinInput').value = '';
                    document.getElementById('pinDisplay').textContent = '••••••';
                    
                    if (pinAttempts >= maxPinAttempts) {
                        document.getElementById('pinModal').style.display = 'none';
                        showLockoutPage();
                    }
                }
            }
        }
        
        function cancelPin() {
            document.getElementById('pinModal').style.display = 'none';
        }
        
        async function processOrderWithPin() {
            // Process the order after successful PIN verification
            const paymentAmount = parseFloat(document.getElementById('paymentAmount').value) || 0;
            const subtotalText = document.getElementById('subtotal').textContent;
            const vatText = document.getElementById('vat').textContent;
            const totalText = document.getElementById('total').textContent;
            
            const subtotal = parseFloat(subtotalText.replace('₱', '').replace(',', '')) || 0;
            const vat = parseFloat(vatText.replace('₱', '').replace(',', '')) || 0;
            const total = parseFloat(totalText.replace('₱', '').replace(',', '')) || 0;
            const change = paymentAmount - total;
            
            showLoading('Processing order...', 'Saving transaction to database');
            
            try {
                // Generate unique receipt ID
                currentReceiptId = generateUniqueId();
                
                // Save transaction to history
                const transaction = {
                    receiptId: currentReceiptId,
                    date: new Date().toISOString(),
                    cashier: document.getElementById('currentCashier').textContent,
                    items: currentOrder.map(item => ({
                        name: item.name,
                        price: item.price,
                        quantity: item.quantity
                    })),
                    subtotal: subtotal,
                    vat: vat,
                    total: total,
                    payment: paymentAmount,
                    change: change
                };
                
                transactionHistory.unshift(transaction);
                await saveTransactionHistory();
                
                // Update product stock in Firebase
                for (const item of currentOrder) {
                    const product = products.find(p => p.id === item.id);
                    if (product) {
                        const newStock = product.stock - item.quantity;
                        product.stock = newStock;
                        await updateProductStock(item.id, newStock);
                    }
                }
                
                // Update daily stats
                dailyStats.totalSales += total;
                dailyStats.itemsSold += currentOrder.reduce((sum, item) => sum + item.quantity, 0);
                dailyStats.transactions += 1;
                updateDailyStats();
                
                hideLoading();
                
                // Generate receipt
                generateReceipt(subtotal, vat, total, paymentAmount, change);
                
                // Show receipt modal
                document.getElementById('receiptModal').style.display = 'flex';
                
                resetSleepTimer();
                
            } catch (error) {
                hideLoading();
                console.error('Error processing order:', error);
                alert('Error processing order. Please try again.');
            }
        }
        
        // Setup Firebase database listener for cart updates
        function setupRFIDDatabaseListener() {
            console.log('Setting up cart database listener');
            
            // Listen for changes to the cart in database
            const cartRef = database.ref('cart');
            
            cartRef.on('child_added', (snapshot) => {
                const cartItem = snapshot.val();
                
                if (cartItem && cartItem.productId && cartItem.isValid) {
                    console.log('📡 Cart item detected in database:', cartItem.productId);
                    handleDatabaseCartItem(cartItem);
                    
                    // Mark cart item as processed
                    snapshot.ref.update({ 
                        isValid: false, 
                        processedAt: firebase.database.ServerValue.TIMESTAMP 
                    });
                }
            });
        }
        
        // Handle cart item from database
        function handleDatabaseCartItem(cartItem) {
            console.log('📡 Processing database cart item:', cartItem);
            
            // Find the product by name (not ID)
            const product = products.find(p => p.name.toLowerCase() === cartItem.productId.toLowerCase());
            
            if (product) {
                addToCart(product);
                showCartFeedback(product);
                resetSleepTimer();
                
                console.log('✅ Product added to cart:', product.name);
            } else {
                console.error('❌ Product not found:', cartItem.productId);
                console.log('Available product names:', products.map(p => p.name));
                showCartFeedback({ name: `Unknown product: ${cartItem.productId}`, emoji: '❓' });
            }
        }
        
        // RFID scan simulation (now checks Firebase)
        async function scanProduct(productId) {
            if (!isRfidConfigured) {
                showRfidSetupModal();
                return;
            }
            
            showLoading('Scanning RFID...', 'Checking product in database');
            
            try {
                // Check if RFID scan is valid in Firebase
                const rfidRef = database.ref(`rfid_scans/${rfidId}`);
                const snapshot = await rfidRef.once('value');
                const rfidData = snapshot.val();
                
                if (rfidData && rfidData.isValid) {
                    // RFID scan is valid, find the product
                    const product = products.find(p => p.id === productId);
                    if (product) {
                        addToCart(product);
                        showCartFeedback(product);
                        
                        // Update RFID scan status in Firebase
                        await rfidRef.update({ isValid: false, lastScan: firebase.database.ServerValue.TIMESTAMP });
                    }
                } else {
                    alert('RFID scan not detected or invalid. Please try again.');
                }
                
                hideLoading();
                resetSleepTimer();
            } catch (error) {
                hideLoading();
                console.error('RFID scan error:', error);
                alert('Error checking RFID scan. Please try again.');
            }
        }
        
        // Add product to cart
        function addToCart(product) {
            const existingItem = cart.find(item => item.id === product.id);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    ...product,
                    quantity: 1
                });
            }
            
            updateCartDisplay();
        }
        
        // Show visual feedback when item is added to cart
        function showCartFeedback(product) {
            // Create a temporary notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(145deg, #4CAF50, #45a049);
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 1000;
                animation: slideInRight 0.3s ease-out;
                font-family: 'Orbitron', monospace;
                font-weight: bold;
            `;
            notification.innerHTML = `✅ ${product.name} added to cart!`;
            
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOutRight 0.3s ease-in';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }
        
        // Update cart display
        function updateCartDisplay() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const floatingCart = document.getElementById('floatingCart');
            const floatingCartCount = document.getElementById('floatingCartCount');
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            
            // Update floating cart count
            floatingCartCount.textContent = totalItems;
            
            // Show/hide floating cart
            if (totalItems > 0) {
                floatingCart.style.display = 'block';
            } else {
                floatingCart.style.display = 'none';
            }
            
            // Update cart items display
            cartItems.innerHTML = '';
            let cartTotalAmount = 0;
            
            cart.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-name">${item.emoji} ${item.name}</div>
                    <div class="cart-item-quantity">${item.quantity}x</div>
                    <div class="cart-item-price">₱${(item.price * item.quantity).toFixed(2)}</div>
                `;
                cartItems.appendChild(cartItem);
                cartTotalAmount += item.price * item.quantity;
            });
            
            // Update cart total
            cartTotal.textContent = `Total: ₱${cartTotalAmount.toFixed(2)}`;
        }
        
        // Toggle cart visibility
        function toggleCart() {
            const cartContent = document.getElementById('cartContent');
            if (cartContent.style.display === 'block') {
                cartContent.style.display = 'none';
            } else {
                cartContent.style.display = 'block';
            }
        }
        
        // Proceed to order page with cart items
        function proceedToOrder() {
            if (cart.length === 0) {
                alert('Cart is empty! Please scan some products first.');
                return;
            }
            
            // Copy cart items to current order (don't clear cart)
            currentOrder = [...cart];
            
            goToOrderPage();
        }
        
        // Add product to current order
        function addToOrder(product) {
            const existingItem = currentOrder.find(item => item.id === product.id);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                currentOrder.push({
                    ...product,
                    quantity: 1
                });
            }
            
            updateOrderDisplay();
        }
        
        // Navigate to order page
        function goToOrderPage() {
            document.getElementById('homepage').style.display = 'none';
            document.getElementById('orderPage').style.display = 'block';
            updateOrderDisplay();
            resetSleepTimer();
        }
        
        // Navigate to homepage (preserve cart)
        function goToHomepage() {
            document.getElementById('orderPage').style.display = 'none';
            document.getElementById('homepage').style.display = 'block';
            
            // Update cart display to show current cart
            updateCartDisplay();
            
            resetSleepTimer();
        }
        
        // Update order display
        function updateOrderDisplay() {
            const orderItems = document.getElementById('orderItems');
            orderItems.innerHTML = '';
            
            if (currentOrder.length === 0) {
                orderItems.innerHTML = '<p style="text-align: center; opacity: 0.7;">No items in order</p>';
                document.getElementById('proceedBtn').disabled = true;
            } else {
                currentOrder.forEach((item, index) => {
                    const orderItem = document.createElement('div');
                    orderItem.className = 'order-item';
                    orderItem.innerHTML = `
                        <div class="item-details">
                            <div style="font-size: 1.2em; font-weight: bold;">${item.emoji} ${item.name}</div>
                            <div style="color: #4CAF50; font-weight: bold;">₱${item.price.toFixed(2)} each</div>
                        </div>
                        <div class="item-controls">
                            <div class="quantity-control">
                                <button class="quantity-btn" onclick="changeQuantity(${index}, -1)">-</button>
                                <span class="quantity">${item.quantity}</span>
                                <button class="quantity-btn" onclick="changeQuantity(${index}, 1)">+</button>
                            </div>
                            <button class="pixel-btn" onclick="removeItem(${index})" style="background: linear-gradient(145deg, #f44336, #d32f2f); margin-left: 15px;">Remove</button>
                        </div>
                    `;
                    orderItems.appendChild(orderItem);
                });
                document.getElementById('proceedBtn').disabled = false;
            }
            
            updateOrderSummary();
        }
        
        // Change item quantity
        function changeQuantity(index, change) {
            if (currentOrder[index]) {
                currentOrder[index].quantity += change;
                if (currentOrder[index].quantity <= 0) {
                    removeItem(index);
                } else {
                    updateOrderDisplay();
                }
            }
        }
        
        // Remove item from order
        function removeItem(index) {
            currentOrder.splice(index, 1);
            updateOrderDisplay();
        }
        
        // Update order summary with VAT calculation
        function updateOrderSummary() {
            const subtotal = currentOrder.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const vat = subtotal * 0.12; // 12% VAT
            const total = subtotal + vat;
            
            document.getElementById('subtotal').textContent = `₱${subtotal.toFixed(2)}`;
            document.getElementById('vat').textContent = `₱${vat.toFixed(2)}`;
            document.getElementById('total').textContent = `₱${total.toFixed(2)}`;
        }
        
        // Calculate change when payment amount is entered
        function calculateChange() {
            const paymentInput = document.getElementById('paymentAmount');
            const paymentAmount = parseFloat(paymentInput.value) || 0;
            const totalText = document.getElementById('total').textContent;
            const total = parseFloat(totalText.replace('₱', '').replace(',', '')) || 0;
            const change = paymentAmount - total;
            
            const changeDisplay = document.getElementById('changeDisplay');
            const proceedBtn = document.getElementById('proceedBtn');
            
            // Clear any previous error states
            paymentInput.style.borderColor = '';
            
            if (isNaN(paymentAmount) || paymentAmount < 0) {
                changeDisplay.innerHTML = '❌ Please enter a valid payment amount';
                changeDisplay.style.color = '#f44336';
                proceedBtn.disabled = true;
                proceedBtn.textContent = 'Invalid Payment';
                return;
            }
            
            if (total <= 0) {
                changeDisplay.innerHTML = '❌ No items in order';
                changeDisplay.style.color = '#f44336';
                proceedBtn.disabled = true;
                proceedBtn.textContent = 'No Items';
                return;
            }
            
            if (paymentAmount >= total) {
                changeDisplay.innerHTML = `💰 Change: ₱${change.toFixed(2)}`;
                changeDisplay.style.color = '#4CAF50';
                proceedBtn.disabled = false;
                proceedBtn.textContent = 'Complete Order';
            } else if (paymentAmount > 0) {
                const needed = total - paymentAmount;
                changeDisplay.innerHTML = `❌ Insufficient payment (Need ₱${needed.toFixed(2)} more)`;
                changeDisplay.style.color = '#f44336';
                proceedBtn.disabled = true;
                proceedBtn.textContent = 'Insufficient Payment';
            } else {
                changeDisplay.innerHTML = '';
                proceedBtn.disabled = true;
                proceedBtn.textContent = 'Enter Payment Amount';
            }
        }
        
        // Process payment and show receipt (now requires PIN)
        function processPayment() {
            const paymentAmount = parseFloat(document.getElementById('paymentAmount').value) || 0;
            const subtotalText = document.getElementById('subtotal').textContent;
            const totalText = document.getElementById('total').textContent;
            
            const total = parseFloat(totalText.replace('₱', '').replace(',', '')) || 0;
            
            // Validate payment
            if (isNaN(paymentAmount) || paymentAmount < total) {
                alert('Invalid payment amount. Please check your input.');
                return;
            }
            
            // Show PIN modal for security verification
            showPinModal();
        }
        
        // Generate digital receipt
        function generateReceipt(subtotal, vat, total, payment, change) {
            const receiptItems = document.getElementById('receiptItems');
            const now = new Date();
            
            document.getElementById('receiptDate').textContent = now.toLocaleString();
            document.getElementById('receiptId').textContent = currentReceiptId;
            
            receiptItems.innerHTML = '';
            currentOrder.forEach(item => {
                const receiptItem = document.createElement('div');
                receiptItem.className = 'receipt-item';
                receiptItem.innerHTML = `
                    <span>${item.name} x${item.quantity}</span>
                    <span>₱${(item.price * item.quantity).toFixed(2)}</span>
                `;
                receiptItems.appendChild(receiptItem);
            });
            
            document.getElementById('receiptSubtotal').textContent = `₱${subtotal.toFixed(2)}`;
            document.getElementById('receiptVAT').textContent = `₱${vat.toFixed(2)}`;
            document.getElementById('receiptTotal').textContent = `₱${total.toFixed(2)}`;
            document.getElementById('receiptPayment').textContent = `₱${payment.toFixed(2)}`;
            document.getElementById('receiptChange').textContent = `₱${change.toFixed(2)}`;
        }
        
        // Close receipt modal
        function closeReceipt() {
            document.getElementById('receiptModal').style.display = 'none';
            
            // Check if this is from history view or new order
            const closeBtn = document.getElementById('receiptCloseBtn');
            if (closeBtn.textContent === 'OK - Return to Homepage') {
                // This is a new order, complete it
                completeOrder();
            } else {
                // This is from history, just close
                // Do nothing special
            }
        }
        
        // Complete order and return to homepage
        function completeOrder() {
            // Clear current order and cart
            currentOrder = [];
            cart = [];
            
            // Reset payment input
            document.getElementById('paymentAmount').value = '';
            document.getElementById('changeDisplay').innerHTML = '';
            
            // Hide receipt modal
            document.getElementById('receiptModal').style.display = 'none';
            
            // Update cart display
            updateCartDisplay();
            
            // Update products display with new stock levels
            renderProducts();
            
            // Return to homepage
            goToHomepage();
            
            // Show success message with animation
            setTimeout(() => {
                showSuccessMessage();
            }, 500);
        }
        
        // Show animated success message
        function showSuccessMessage() {
            const successModal = document.createElement('div');
            successModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 2000;
                animation: fadeIn 0.3s ease-in;
            `;
            
            successModal.innerHTML = `
                <div style="
                    background: linear-gradient(145deg, #1e1e42, #2a2a5c);
                    padding: 40px;
                    border-radius: 15px;
                    text-align: center;
                    color: white;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.8);
                    animation: bounceIn 0.6s ease-out;
                ">
                    <div style="
                        width: 80px;
                        height: 80px;
                        border-radius: 50%;
                        background: #4CAF50;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        margin: 0 auto 20px;
                        font-size: 2em;
                        animation: pulse 1s ease-in-out infinite;
                    ">✅</div>
                    <h2 style="color: #4CAF50; margin-bottom: 15px;">Order Completed!</h2>
                    <p style="margin-bottom: 20px;">Thank you for your purchase at 7-Evelyn!</p>
                    <button class="pixel-btn" onclick="this.parentElement.parentElement.remove()">
                        Continue Shopping
                    </button>
                </div>
            `;
            
            document.body.appendChild(successModal);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (successModal.parentNode) {
                    successModal.remove();
                }
            }, 5000);
        }
        
        // Update daily statistics display
        function updateDailyStats() {
            document.getElementById('totalSales').textContent = `₱${dailyStats.totalSales.toFixed(2)}`;
            document.getElementById('itemsSold').textContent = dailyStats.itemsSold;
            document.getElementById('transactions').textContent = dailyStats.transactions;
            
            const avgTransaction = dailyStats.transactions > 0 ? 
                dailyStats.totalSales / dailyStats.transactions : 0;
            document.getElementById('avgTransaction').textContent = `₱${avgTransaction.toFixed(2)}`;
        }
    </script>
</body>
</html>
